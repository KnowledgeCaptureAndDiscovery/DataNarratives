<!-- Import scripts - webcomponents(js) and jquery and web componenents (.html) -->
<script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/app-layout/app-layout.html">
<link rel="import" href="/bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="/bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="/bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="/bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="/bower_components/app-layout/demo/sample-content.html">
<link rel="import" href="/bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/polymer/lib/utils/gestures.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html"> 
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/bower_components/resizable-panels/resizable-panels.html">
<link rel="import" href="/bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="/bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="/bower_components/iron-collapse-button/iron-collapse-button.html">

<!-- 
Define the web component feedback-app in <dom-module>
Definition consists of structure - defined in <template> tag, and scripts defined in <script> tag 
Style and custom style is also included in <template>
In Polymer, the web component defined by <dom-module> is associated with an ES6/JavaScript class
Using this web component (simply dropping it in an HTML document)creates an instance of the associated class in the browser
The web component defines a 'shadow DOM' i.e. its internal components (other HTML tags or web componenets)
are visible to the instance but not to the DOM tree
Each web component has properties which could be data or methods
Both one-way and two-way binding between the properties in the object and attributes or content of 
tags in the <template> are allowed. 
-->

<dom-module id="feedback-app">
  
    <template>
        <custom-style>
            <style is="custom-style">
              html, body {
                margin: 0;
                font-family: 'Roboto', 'Noto', sans-serif;
                -webkit-font-smoothing: antialiased;
                background: #f1f1f1;
                max-height: 368px;
              }
              app-toolbar {
                background-color: #4285f4;
                color: #fff;
              }
          
              paper-icon-button {
                --paper-icon-button-ink-color: white;
              }
        
              #main-content{
                display: flex;
              }
              #narrative-views{
                border-width: 2px;
                border-style:solid;
                border-color: chocolate;
                margin-top: 0px;
                margin-right: 0px;
                display: list-item;
                padding: 20px;
              }
              #narrative-editor{
                border-style: dotted;
                border-width: 4px;
                border-color: coral;
                margin-top: 0px;
                margin-left: 0px;
                width: 500px;
                position: fixed;
              }
              sample-content {
                padding-top: 64px;
              }
              
              paper-card{
                color: black;
                width: 100%;
              }
              paper-tooltip{
                --paper-tooltip-delay-in: 500;
                font-size: 12pt;
              }
              .panel { 
                padding: 20px; 
                color: white; 
                width: 100%;
                height: 100%;
                /* max-width: 100%; */
              }
              .p1 { 
                background-color: white; 
                width: 100%;
                height: 100%;
                /* max-width: 100%;  */
                overflow-y: auto;
              }
              .p2 { 
                background-color: beige; 
                width: 50%;
                height: 100%;
                /* max-width: 50%  */
              }
              #card-body{
                margin:20px;
              }
              
          </style>
        </custom-style>
    
        <!--
          The structure of the document is created by putting in tags - 
          HTML or web components (user-defined or from a library).
          <app-header-layout> positions an <app-header> and other content
        -->
        <app-header-layout>
          <app-header>
            <app-toolbar>
              DANA: DAta NArratives
            </app-toolbar>
          </app-header>
    
          <!--
            <resizable-panels> creates resizable panels (horizontally by default) - each of which is placed in a <div>
            -->  
          <resizable-panels>
            <!--
              The first panel is for placing the narrative views
            -->
            <div class="panel p1" id="view">
              <!--
                Each narrative is placed in a <paper-card>
                It contains a heading like <paper-toolbar>, 
                <paper-tooltip> for displaying tooltip text,
                followed by the actual body of the card.
                This body is encapsulated in an <iron-collapse> tag
                for collapsing or expanding the card. The body contains
                buttons in <paper-button> and a <div> for holding the narrative
                text
                The contents into <paper-toolbar>, <paper-tooltip> and the body
                are loaded when the element loads in the ready() method.
                Right now, there is only one narrative displayed.
                -->
              <paper-card id="viewone">
                <paper-toolbar on-click="_toggleCollapse">
                    <div slot="top" class="title" id="cardtitle"></div>
                </paper-toolbar>
                <paper-tooltip id="cardtooltip" for="cardtitle" position="top"></paper-tooltip>
                <iron-collapse id="collapse">
                  <div id="card-body">
                      <div class="card-actions">
                          <div class="horizontal justified">
                            <!--
                              Clicking the 'Edit' button opens the narrative editor - the second <div> as panel
                              Clicking the 'See More' button will show hidden parts of the test
                              Clicking the 'See Less' button will hide hideable parts of the text
                              The event handlers are defined in the <script> tag as instance methods of FeedbackApp
                              -->
                              <paper-button on-click="openEditor">Edit</paper-button>
                              <paper-button on-click="seeMore" data-args="#viewone">See More</paper-button>
                              <paper-button on-click="seeLess" data-args="#viewone">See Less</paper-button>
                          </div>
                      </div>
                      
                      <div class="card-content" id="cardcontent"></div>
                  </div>
                    
                </iron-collapse>
                
                    
              </paper-card>
    
              <br/>
    
              </div>
              <!-- 
                The second panel is for dislaying the narrative editor
                The narrative editor is inserted with the text content of the 
                view which caused the opening of the editor
              -->
              <div class="panel p2" id="editor" hidden$="{{hide}}">
                  <paper-card>
                      <paper-toolbar>
                          <div slot="top" class="title">Narrative Editor</div>
                      </paper-toolbar>
                      <div class="card-actions">
                          <div class="horizontal justified">
                            <!--
                              Clicking 'Close' button will clear the narrative editor of its contents
                              and close it
                            --> 
                              <paper-button>Edit Links</paper-button>
                              <paper-button>Edit Text</paper-button>
                              <paper-button>Record Edits</paper-button>
                              <paper-button  on-click="closeEditor">Close</paper-button>
                          </div>
                      </div>
    
                      <div class="card-content" id="editorarea"></div>
                    
                  </paper-card>
                  
              </div>
            </resizable-panels>
    
        </app-header-layout>
       
       
      </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class FeedbackApp extends Polymer.Element {
      static get is() { return 'feedback-app'; }
      static get properties(){
        return {
          /*
          The 'hide' property is used to hide or reveal the <div> containing narrative editor
          */
          hide: {
            type: Boolean,
            value: true
          },
          /*
          The narrative property is not used right now
          It will be used to try to bind the contents of the <paper-card> to properties
          instead of filling innerHTML as of now
          */
          narratives: {
            title: {
              type: String,
              value: ""
            },
            tooltip_text: {
              type: String,
              value: ""
            },
            text: {
              type: String,
              value: ""
            }
          }
        }
      }
      /*
        Hide all <span> tags with class "see"
      */
      seeLess(e){
        var cardid = e.target.getAttribute('data-args');
        var card = Polymer.dom(this.root).querySelector(cardid);
        $(card).find(".see").hide();
      }
      /*
        Show all <span> tags with class "see"
      */
      seeMore(e){
        var cardid = e.target.getAttribute('data-args');
        var card = Polymer.dom(this.root).querySelector(cardid);
        $(card).find(".see").show(); 
      }
      /*
        Open the <div> containing the narrative editor and populate it with the 
        contents of the view that caused the editor to open
      */ 
      openEditor(){
        if(this.hide == true){
          this.$.editor.style.width = "50%";
          this.$.view.style.width = "50%";
          this.$.editorarea.innerHTML = this.$.cardcontent.innerHTML;
          this.hide = false;
        }
      }
      /*
        Close the editor
      */
      closeEditor(){
        if(this.hide == false){
          this.hide = true;
          this.$.editorarea.innerHTML = "";
          this.$.view.style.width = "100%"; 
        }
      }
      /*
        Toggle the card to expand or collapse
      */
      _toggleCollapse(e) {
        this.$.collapse.toggle();
	    }
      /*
        ready event. It makes an ajax call to retrieve narratives from a JSON file
        Then it manipulates the shadow DOM to insert the data
      */
      ready(){
        super.ready();
        var _self = this;
        $.get("/src/feedback-app/data_narratives.json", function(data){
          _self.$.cardtitle.innerHTML= data[0].title;
          _self.$.cardcontent.innerHTML = data[0].text;
          _self.$.cardtooltip.innerHTML = data[0].tooltip_text;
          // _self.narratives = data[0];
          // _self.$.cardcontent.innerHTML = $.parseJSON(_self.$.cardcontent.innerHTML);
        });
      }
    }
    /*
      Most crucially, establish a binding between the name of the web component
      'feedback-app', which is returned by FeedbackApp.is and the class FeedbackApp
      This is called registration
    */
    window.customElements.define(FeedbackApp.is, FeedbackApp);
  </script>
</dom-module>
